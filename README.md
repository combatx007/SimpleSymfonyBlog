Блог – первый проект на Symfony2.

Эта статья предназначена для тех, кто только начинает знакомиться с фремворокм Symfony2. Здесь будут описаны основные этапы создания блога на нем, приведены ссылки на документацию и прочие обучающие материалы, информацию, которую необходимо знать и понимать.

-<a href="https://github.com/combatx007/SimpleSymfonyBlog">Блог на гитхабе</a>

-<a href="http://simple-blogs.tk/">на сервере</a>



Прежде всего, у вас должен стоят php+mysql сервер, а также все необходимые инструменты, информацию о том, как установить и настроить весь необходимый инструментарий можно найти на сайте (я делал по данной инструкции):
http://smart-core.org/wiki/%D0%A3%D1%81%D1%82%D0%B0%D0%BD%D0%BE%D0%B2%D0%BA%D0%B0_%D0%B2%D0%B5%D0%B1-%D1%81%D0%B5%D1%80%D0%B2%D0%B5%D1%80%D0%B0_%D0%BD%D0%B0_Windows

Теперь, когда есть все для начала работы, необходимо установить сам фреймворк Symfony2:

http://symfony.com/

В официальной документации:

http://symfony.com/doc/master/book/index.html (енг.)
http://symfony-gu.ru/documentation/ru/html/index.html (рус.)

Есть подробное описание установки и настройки Symfony2.

Далее приступаем непосредственно к разработке. Конфигурируем бандл User (все делается достаточно просто, т.к. будем использовать FOSUserBundle), мануал и сам бандл можно найти <a href="https://github.com/FriendsOfSymfony/FOSUserBundle/blob/master/Resources/doc/index.md">здесь</a>.
Затем создаем сам бандл Blog, подробно создание бандла расписано как в русской, так и в оригинальной документации.  Соответственно при создании бандла BlogBundle для просмотра результата нам необходим какой-либо шаблон, поэтому неплохо было бы на данном этапе уже иметь заготовку, это позволит видеть все более наглядно.
Создаем сущность Post в бандле BlogBundle, здесь будет описано при помощи php и аннотаций (см. информацию по Doctrine http://symfony.com/doc/master/book/doctrine.html), какую информацию в конечном итоге будет содержать таблица Post в вашей базе данных (заголовки, посты и т.д.).  Так как нам необходимо чтобы каждый пост принадлежал какому-либо  автору, то необходимо задать эту связь при помощи аннотаций Doctrine через отношение «One-To-Many, Bidirectional» (http://odiszapc.ru/doctrine/association-mapping/). 
Также создаем фикстуры – дефолтные значения, которые заносятся в БД (http://symfony.com/doc/master/bundles/DoctrineFixturesBundle/index.html).  Лучшим вариантом будет вынести их в отдельный бандл.
Так как у нас должен в итоге получится блог, то у нас должна быть «лента постов», т. е. на  1 странице, например, 1 нас будет по 3 поста, в т. ч. и на «главной». Таким образом, нам необходимо прописать соответствующие маршруты для главной страницы и для остальных страниц нашей ленты (https://github.com/combatx007/SimpleSymfonyBlog/blob/master/src/Acme/BlogBundle/Resources/config/routing.yml). После этого мы можем написать контроллер для главной страницы. Необходимо чтобы выводилось по 3 поста на страницу поочередно, соответственно на «главной» у нас всегда должно быть 3 самых свежих поста. Для этого мы при помощи метода findBy()  (см. http://symfony.com/doc/2.0/book/doctrine.html) вытаскиваем из базы соответствующие посты и воспроизводя их в обратном порядке.

<a href="https://github.com/combatx007/SimpleSymfonyBlog/blob/master/src/Acme/BlogBundle/Controller/DefaultController.php#L22-L27">ПРИМЕР</a>

Здесь мы в качестве пустого массива указываем критерии отбора, следующий пункт говорит о том, что последовательность будет в обратном порядке по дате обновления поста, ограничение по количеству выводимых постов записано в переменной $limit, ну и значение «0» - отступ в базе данных.
Теперь можно перейти  к написанию контроллера для вывода страниц блога. Для этого мы вновь обращаемся к файлу routing.yml. В моем случае, я сделал маршрут /page/{id}, где id ограничен цифровым значением:
requirements:
        id:  \d+
        
Приступая к написанию контроллера для вывода постов на странице, нужно понимать как вычислить отступ на соответствующей странице вашего блога. Для этого можно взять следующую формулу:

$offset = ($id - 1) * $limit;

где $id – id конкретной страницы, который будет передаваться в контроллер при заходе посетителем на ту или иную страницу блога (например, site.ru/page/2). Далее аналогично предыдущему контроллеру вытаскиваем записи при помощи findBy(), только теперь вместо числового значения «0» последним аргументом у нас будет переменная $offset. После передаем все в шаблон.

Теперь нам нужно прописать маршрут и описать контроллер для отображения одного поста. Для этого нужно просто вытащить из базы пост с соответствующим id (он будет браться из uri нашего маршрута, например, site.ru/post/2, id = 2). Пример:

$post = $em->find('AcmeBlogBundle:Post', $id);

Таким образом у нас теперь есть лента постов, в которой выводится по 3 новости на страницу, а также настроено отображение каждого отдельного поста.
Саму визуальную навигацию можно оформить прямо в шаблонизаторе (см. <a href="https://github.com/combatx007/SimpleSymfonyBlog/">пример на гитхабе</a>).

Далее нам понадобится создать редактирование, добавление и удаление постов. С добавлением постов все просто, при помощи:
$post->setUser($this->get('security.context')->getToken()->getUser());

мы узнаем какой пользователь залогинен на данный момент, а далее берем данные из формы, и передаем их объекту (соответственно впоследствии информация пишется в БД).
Редактирование постов можно сделать как отдельно (т. е. что-то вроде мини админки), а также непосредственно добавить возможность редактирования при просмотре поста соответствующим пользователям. На моем блоге реализованы оба варианта. 
Для начала как обычно прописываем нужный маршрут и начинаем описывать контроллер. Здесь необходимо организовать само редактирование и отправку данных  в БД. Для большей удобности советую вынести описание типов форм в отдельные файлы. У меня этот файл называется PostFormType.php. В нем указываем какие поля будет содержать форма, сущность с которой мы она будет взаимодействовать, а также уникальное имя. Пример:
<a href="https://github.com/combatx007/SimpleSymfonyBlog/blob/master/src/Acme/BlogBundle/Form/Type/PostFormType.php">PostFormType.php</a>

Теперь в контроллере для редактирования постов мы создаем форму, а далее принимаем данные, переданные методом POST, производим проверки и отправляем в БД.
Выше я говорил о 2 способах реализации редактирования постов. Первый из них можно сделать в шаблонизаторе при помощи проверки прав пользователя и принадлежности ему данного поста. При выполнении условий он получит ссылку на редактирование данного поста.
Если мы хотим реализовать тоже самое, но через админку, нужно прописать соответствующий маршрут, описать контроллер для постраничного вывода имеющихся заголовков новостей и ссылки на редактирование каждой конкретной новости. Также в админке можно добавить помимо ссылке на редактирование, ссылку на удаление поста. Делается это просто, при помощи полученного id поста отбираем нужную запись из базы данных и посылаем команду  $this->getDoctrine()->getManager()->remove($post); 
